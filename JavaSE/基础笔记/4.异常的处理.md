# 第四章 - 异常的处理

> 这里的异常，是指运行期间出错

## 1 Java 异常概念

1. 当异常出现的时候，要注意控制台中提示的出错名字与行号
2. 应该在异常发生时提供处理这里错误的方法
3. java程序执行过程中出现异常，会生成一个异常对象，并提交给java运行时系统，这个过程称为**抛出（throw）异常**
4. Java 运行时系统受到异常对象，会寻找能处理这个异常的代码并把当前异常对象交给其处理，这个过程称为**捕获（catch）异常**

> 注意

1. 错误一出现，系统就会找catch代码，否则直接抛出
2. 想用catch，必须要写try，try里写可能发生异常的语句
3. 可以在方法声明时，方法名形参列表后面，使用 `throws xxx` （xxx为异常名）来声明该方法可能抛出的异常

### 1.1 Java 异常分类

所有异常类的根类是 Throwable，其已知两个子类：

- **Error**- 这类是系统错误，是程序无法处理的错误，表示运行应用程序中较严重问题。大多数错误与代码编写者执行的操作无关，而表示代码运行时 JVMJava 虚拟机出现的问题。
- **Exception** - 可以被程序本身处理的异常。
  - **RuntimeException** - Exception的一个重要子类，RuntimeException 类及其子类表示“JVM 常用操作”引发的错误。

> 注意：异常和错误的区别：异常能被程序本身可以处理，错误是无法处理。

通常，Java的异常(包括Exception和Error)分为**可查的异常（checked exceptions）和不可查的异常（unchecked exceptions）**

- **可查异常** - **编译器要求必须处置的异常。**正确的程序在运行中，很容易出现的、情理可容的异常状况。可查异常虽然是异常状况，但在一定程度上它的发生是可以预计的，而且一旦发生这种异常状况，就必须采取某种方式进行处理。
- **不可查异常** - **编译器不要求强制处置的异常**。包括运行时异常（RuntimeException与其子类）和错误（Error）。

Exception 这种异常分两大类**运行时异常**和**非运行时异常(编译异常)**。程序中应当尽可能去处理这些异常。

- **运行时异常：**都是RuntimeException类及其子类异常，如NullPointerException(空指针异常)、IndexOutOfBoundsException(下标越界异常)等，这些异常是不检查异常，程序中可以选择捕获处理，也可以不处理。这些异常一般是由程序逻辑错误引起的，程序应该从逻辑角度尽可能避免这类异常的发生。运行时异常的特点是Java编译器不会检查它，也就是说，当程序中可能出现这类异常，即使没有用try-catch语句捕获它，也没有用throws子句声明抛出它，也会编译通过。
- **非运行时异常 （编译异常）：**是RuntimeException以外的异常，类型上都属于Exception类及其子类。从程序语法角度讲是必须进行处理的异常，如果不处理，程序就不能编译通过。如IOException、SQLException等以及用户自定义的Exception异常，一般情况下不自定义检查异常。

### 1.2 Java 异常的处理

在java中，处理异常有两种机制：抛出异常、捕获异常。

> 简单地说，异常总是先被抛出，后被捕捉的。

```java
// 捕获异常
try {
    // 可能会发送异常的程序代码
} catch（xxxException e） {
    // 捕获并处理try抛出的异常
} catch （xxxException e） {
    // 可以捕获另一种异常
} finally {
    xxx
}
```

> 注意

1. 当try中语句发送异常后，被相应的catch捕获，并执行catch中的代。
2. finally中的代码无论是否出现异常都会在最后被执行
3. 如果发送了异常，try中语句停止继续执行，执行catch中代码。当catch中代码执行完，如果存在finally则执行finally代码，否则这段代码执行完成，**注意**：如果catch中没有抛出异常，或者返回（return），那么**catch后的代码会继续被执行**。因为java认为你已经处理了这个异常，不再存在问题。
4. 当方法有些异常处理不了或者不方便处理，可以选择抛出异常，由上一级去处理
5. 当别的方法向调用抛出异常的方法时（即可查异常），这个方法要么处理异常，要么同样抛出异常。在main方法中也同样，但是不建议在main中抛出异常。
6. 捕获异常，先捕获小的，再到大的。即多个catch从上到下，异常因为从小到大。

### 1.3 自定义异常

1. 通过继承 `java.lang.Exception` 类声明自己的异常类
2. 在方法适当的位置生成自定义异常的实例，并用throw 语句抛出
3. 在方法的声明部分throws语句声明该方法可能抛出的异常

> 注意

1. 可以继承其他异常类
2. throw在方法中使用，throws在方式声明中使用
3. 当实际运行时，一旦有异常抛出，那么下面的语句是不会执行的
4. 如果被重写的方法需要抛出异常，那么重写方法需要抛出同样的异常或捕获这些异常
5. 异常一致，是指完全一样，抛出的范围大小和多少都一样
6. 不抛出异常，是完全不抛出，不是处理异常。