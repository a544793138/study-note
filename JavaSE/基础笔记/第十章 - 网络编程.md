# 第十章 - 网络编程

> 基础概念

网络编程 != 网站编程。QQ是网络编程，网页上的是网站编程。

> 网络通信协议

就是两个机器间规定怎么对话

> 分层思想

屏蔽底层的东西，我们不需要动手做，让我们更好的通信。就像上司下属，上司吩咐下去就可以了。

- 分层标准：两种（ISO，TCP/IP）
  - 实际上的标准是 TCP/IP标准，它有4层模型：
    - 应用层（我们编写的程序在这层）
    - 传输层
    - 网络层
    - 物理+数据链路层

> IP协议

网络层的主要协议，支持网络间互连的数据报通信。提供独一无二的IP地址。IP地址占4个字节，分成4段，每段最高不超过255（这是IPV4）。当IPV4不够用了，就开始使用IPV6。注意，IP地址也有虚实。

> TCP协议与UDP协议

两者位于同一层上，建立在IP上，这两种相当于通话方式

- TCP - 可靠的连接，但是效率慢，不允许丢包（包里有数据）
  - 可靠的，是指先要建立起通道，相当于打电话，你说喂，他说喂，这样你才知道另一边有人在听，通道通了。
  - 发消息时，这边发出的消息，必须要另一边确认。例如你说要做什么，他那边就需要提出是否确认。
  - 所以，一般TCP是一定能到达对方的
- UDP - 不可靠，但是效率快，是允许丢包的
  - 不管对方收没有收到，发了就算了，是不可靠的。QQ就相当于UDP，网上游戏过程也是UDP，你的任务不关别人的事。当然账号密码可能是TCP的。

## 1 Socket

一般网络编程都叫Socket编程

1. 两个java应用程序可以通过一个双向的网络通信连接实现数据交换，这个双向链路的一端称为一个Socket。
2. Socket通常用来实现client-server连接
3. java.net (java中所以关于网络编程的类都在里面)，包中定义两个类，Socket（用于client端的），ServerSocket(用于TCP的服务器端，server，因为UDP没有所谓的server)。

4. 建立连接时所需的寻址信息为远程计算机的IP地址和端口号（port）。
   - 端口号：微信上的信息不会发到QQ上，是因为有一个东西在区分着应用程序，就是端口号，占用两个字节，最多65536个
   - 一个应用程序可以占多个端口号，自己写的程序端口号选1024以上，1024下的系统随时征用。
   - 端口号又分为两种，TCP和UDP的，各有65536个。

> 编写

1. 启动时先启动server，再启动client
2. ServerSocket()是阻塞式的，等着Client连接。括号里是填端口号，表示监听哪个端口。
3. Client端的Socket()，要指定本机地址（不是指你电脑的IP地址，是你这个Client的地址），和要连接Server端的端口号，client是不需要指定一个端口号，系统随便找一个端口给它用于连接server中的指定端口号。
4. 当server端和client端写上端口的监听和接收后，连接就建立了，但是server端还要把client的端口接收进来，这就利用到了 accept()方法，是阻塞的方法，如果没有client连接，它就会等着。

5. 因为一个server可以供多个client连接，所以一般来说accept()写在死循环中，不断地接收
6. 当一个server的已经启动了，并在指定端口号绑定了监听，如果再起一个监听同样端口号的server会报错。运行中的server可以用ctrl+c停止

7. 连接中有两根管理，一个输出一个输入，输出输入是对各自而言的，server输出就是server的输出，对应client的输入；client的输出时client的输出，对应server的输入。

8. socket同样要close

## 2 UDP

UDP是没有实际意义上的server和client的，都是用 DatagramSocket()

1. DatagramSocket()，括号里填写端口号
2. 实际上UDP和TCP都是用数据包来传递信息的，TCP里有连接，有输出输入管道，但是UDP中没有，必须用数据报包
3. 真正装数据的不是 DatagramPacket，而是DatagramPacket中的数组。DatagramPacket，相当于一个大包袱，把各种各样的数组包起来。
4. receive() 和 send() 是对应的，receive是接受，send是发送，括号里都是DatagramPacket类型。receive是阻塞式的。
5. 在DatagramPacket中，用数组装数据，但不一定用数组的全部容量来装，同时也不一定能装满规定的数据。这是允许的。
6. 发送数据的DatagramPacket中，要给这各DatagramPacket对象指定一个IP地址和另一端在监听的端口号。
7. UDP端口号和TCP端口号分开，都有65536个。
8. InetSocketAddress能创建地址类的东西
9. UDP的Socket只有Client端要close